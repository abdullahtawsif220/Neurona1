<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Investment Requests - Neurona</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/creator_dashboard.css') }}"/>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
  <div class="container d-flex justify-content-between align-items-center">
    <div class="logo">
      <img src="{{ url_for('static', filename='images/logo_white.png') }}" class="navbar-logo" alt="Neurona Logo">
    </div>
    <div class="ms-auto">
      <a href="{{ url_for('creator_dashboard') }}" class="back-btn" style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px; color: #1a1a1a; text-decoration: none; font-weight: 500; transition: all 0.3s ease;">
        <i class="fas fa-arrow-left"></i>
        Back to Dashboard
      </a>
    </div>
  </div>
</nav>

<div class="container my-5">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4" style="color: #404145; font-weight: 700;">Investment Requests</h2>
      <p class="text-muted mb-4">Review and manage investment requests for your ideas</p>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="row g-4">
    {% for request in pending_requests %}
    <div class="col-lg-6 col-md-12">
      <div class="card h-100" style="background: #ffffff; border: 1px solid #e4e5e7; border-radius: 12px; overflow: hidden; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-header" style="background: #f8f9fa; border-bottom: 1px solid #e4e5e7; padding: 20px;">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="card-title mb-1" style="color: #404145; font-weight: 600;">{{ request.title }}</h5>
              <small class="text-muted">Submitted {{ request.created_at.split(' ')[0] if request.created_at else 'Recently' }}</small>
            </div>
            <span class="badge bg-warning text-dark">Pending</span>
          </div>
        </div>
        
        <div class="card-body" style="padding: 20px;">
          <div class="row mb-3">
            <div class="col-6">
              <strong style="color: #404145;">Investment Amount:</strong>
              <div style="font-size: 1.2rem; font-weight: 600; color: #28a745;">BDT {{ "{:,.0f}".format(request.investment_amount) }}</div>
            </div>
            <div class="col-6">
              <strong style="color: #404145;">Investor:</strong>
              <div style="font-weight: 500;">{{ request.investor_name }}</div>
              <small class="text-muted">{{ request.investor_email }}</small>
            </div>
          </div>
          
          {% if request.message %}
          <div class="mb-3">
            <strong style="color: #404145;">Message from Investor:</strong>
            <div class="mt-1 p-2" style="background: #f8f9fa; border-radius: 6px; font-style: italic;">
              "{{ request.message }}"
            </div>
          </div>
          {% endif %}
          
          <div class="mb-3">
            <strong style="color: #404145;">Idea Summary:</strong>
            <p class="text-muted mb-0">{{ request.summary }}</p>
          </div>
        </div>
        
        <div class="card-footer" style="background: #ffffff; border-top: 1px solid #e4e5e7; padding: 20px;">
          <div class="d-flex gap-2">
            <button class="btn btn-success flex-fill" onclick="handleRequest('{{ request.id }}', 'approve')" style="font-weight: 600;">
              <i class="fas fa-check me-2"></i>Accept Request
            </button>
            <button class="btn btn-outline-danger flex-fill" onclick="handleRequest('{{ request.id }}', 'decline')" style="font-weight: 600;">
              <i class="fas fa-times me-2"></i>Decline
            </button>
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
      <div style="background: #f8f9fa; border-radius: 12px; padding: 40px;">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">No pending investment requests</h4>
        <p class="text-muted">When investors show interest in your ideas, their requests will appear here.</p>
        <a href="{{ url_for('creator_dashboard') }}" class="btn btn-primary">View My Ideas</a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmationModalLabel">Confirm Action</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="confirmationMessage">
        Are you sure you want to perform this action?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="confirmButton">Confirm</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
let currentRequestId = null;
let currentAction = null;

function handleRequest(requestId, action) {
  currentRequestId = requestId;
  currentAction = action;
  
  const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
  const messageEl = document.getElementById('confirmationMessage');
  const confirmBtn = document.getElementById('confirmButton');
  
  if (action === 'approve') {
    messageEl.textContent = 'Are you sure you want to accept this investment request? The investor will be notified and can proceed to payment.';
    confirmBtn.className = 'btn btn-success';
    confirmBtn.textContent = 'Accept Request';
  } else {
    messageEl.textContent = 'Are you sure you want to decline this investment request? The investor will be notified.';
    confirmBtn.className = 'btn btn-danger';
    confirmBtn.textContent = 'Decline Request';
  }
  
  modal.show();
}

document.getElementById('confirmButton').addEventListener('click', function() {
  if (currentRequestId && currentAction) {
    window.location.href = `/creator/investment_request/${currentRequestId}/${currentAction}`;
  }
});

// Auto-hide flash messages
setTimeout(function() {
  const alerts = document.querySelectorAll(".alert");
  alerts.forEach(alert => {
    alert.classList.remove("show");
    alert.classList.add("fade");
  });
}, 4000);
</script>

</body>
</html>